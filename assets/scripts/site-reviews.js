!function(){"use strict";var e,t=function(t,i,n){o(i),e.open("GET",t,!0),e.responseType="text",a(n),e.send()},i=function(t,i,n){o(i),e.open("POST",GLSR.ajaxurl,!0),e.responseType="json",e.json=!0,a(n),e.send(r(t))},n=function(e){return"json"===this.responseType||!0===this.json?e({message:this.statusText},!1):"text"===this.responseType?e(this.statusText):void console.error(this)},s=function(e){if(0===this.status||this.status>=200&&this.status<300||304===this.status){if("json"===this.responseType)return e(this.response.data,this.response.success);if("text"===this.responseType)return e(this.responseText);if(!0===this.json){var t=JSON.parse(this.response);return e(t.data,t.success)}console.info(this)}else n.bind(this,e)},r=function(e){var t=new FormData,i=Object.prototype.toString.call(e);return"[object FormData]"===i&&(t=e),"[object HTMLFormElement]"===i&&(t=new FormData(e)),"[object Object]"===i&&Object.keys(e).forEach((function(i){return t.append(i,e[i])})),t.append("action",GLSR.action),t.append("_ajax_request",!0),t},o=function(t){(e=new XMLHttpRequest).addEventListener("load",s.bind(e,t)),e.addEventListener("error",n.bind(e,t))},a=function(t){for(var i in(t=t||{})["X-Requested-With"]="XMLHttpRequest",t)t.hasOwnProperty(i)&&e.setRequestHeader(i,t[i])},l={get:t,post:i},c={},u=function(e,t){var i=c[e]||[],n=[];t&&[].forEach.call(i,(function(e){t!==e.fn&&t!==e.fn.once&&n.push(e)})),n.length?c[e]=n:delete c[e]},h=function(e,t,i){(c[e]||(c[e]=[])).push({fn:t,context:i})},d=function(e,t,i){var n=function n(){u(e,n),t.apply(i,arguments)};n.once=t,h(e,n,i)},f=function(e){var t=[].slice.call(arguments,1),i=(c[e]||[]).slice();[].forEach.call(i,(function(e){return e.fn.apply(e.context,t)}))},v={events:c,off:u,on:h,once:d,trigger:f};function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,i){return t&&g(e.prototype,t),i&&g(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}var b="function",w="isNode",E=function(e,t){return y(e)===t},_=function e(t,i){null!==i&&(Array.isArray(i)?i.map((function(i){return e(t,i)})):(k[w](i)||(i=document.createTextNode(i)),t.appendChild(i)))};function k(e,t){var i,n,s=arguments,r=1;if(e=k.isElement(e)?e:document.createElement(e),E(t,"object")&&!k[w](t)&&!Array.isArray(t))for(i in r++,t)n=t[i],i=k.attrMap[i]||i,E(i,b)?i(e,n):E(n,b)?e[i]=n:e.setAttribute(i,n);for(;r<s.length;r++)_(e,s[r]);return e}k.attrMap={},k.isElement=function(e){return e instanceof Element},k[w]=function(e){return e instanceof Node};var L={hidden:"glsr-hidden",readmore:"glsr-read-more",visible:"glsr-visible"},S={hiddenText:".glsr-hidden-text",wrap:".glsr-tag-value"},x=function(){function e(t){var i=this;p(this,e),this.events={click:this._onClick.bind(this)},(t||document).querySelectorAll(S.hiddenText).forEach((function(e){return i.init(e)}))}return m(e,[{key:"init",value:function(e){var t=this._insertLink(e);t&&("expand"===e.dataset.trigger&&(t.dataset.text=e.dataset.showLess,t.removeEventListener("click",this.events.click),t.addEventListener("click",this.events.click)),"modal"===e.dataset.trigger&&(t.dataset.glsrTrigger="glsr-modal-review"))}},{key:"_insertLink",value:function(e){var t=e.parentElement.querySelector("."+L.readmore);if(!t){var i=k("a",{href:"#"},e.dataset.showMore),n=k("span",{class:L.readmore},i);t=e.appendChild(n)}return t.querySelector("a")}},{key:"_onClick",value:function(e){e.preventDefault();var t=e.currentTarget,i=t.parentElement,n=t.closest(S.wrap),s=n.querySelector(S.hiddenText),r=t.dataset.text,o=t.innerText;t.dataset.text=o,t.innerText=r,t.removeEventListener("click",this.events.click),"false"===n.dataset.expanded?(n.querySelector("p:last-of-type").appendChild(i),n.dataset.expanded=!0):(s.appendChild(i),n.dataset.expanded=!1),t.addEventListener("click",this.events.click),t.focus()}}]),e}(),R=function(){function e(t){p(this,e),this.Form=t,this.captchaEl=this._buildContainer(),this.id=-1,this.instance=null}return m(e,[{key:"execute",value:function(){var e=this;this.captchaEl?"friendlycaptcha"===GLSR.captcha.type?setTimeout((function(){1==+e.captchaEl.dataset.token||".ERROR"===e.Form.form["frc-captcha-solution"].value?e.Form.submitForm():e.execute()}),200):1==+this.captchaEl.dataset.error?this.Form.submitForm("sitekey_invalid"):grecaptcha.execute(this.id,{action:"submit_review"}):this.Form.submitForm()}},{key:"render",value:function(){var e=this;this.Form.form.onsubmit=null,this.reset(),this.captchaEl&&setTimeout((function(){if(-1===e.id&&null===e.instance){var t="undefined"==typeof grecaptcha||void 0===grecaptcha.render,i="undefined"==typeof friendlyChallenge||void 0===friendlyChallenge.WidgetInstance;if(t&&i)e.render();else try{"friendlycaptcha"===GLSR.captcha.type?e._renderFrcaptcha():e._renderRecaptcha()}catch(e){console.error(e)}}}),200)}},{key:"reset",value:function(){-1!==this.id&&grecaptcha.reset(this.id),this.captchaEl&&(this.captchaEl.dataset.error=0),this.instance&&(this.captchaEl.dataset.token=0,this.instance.reset()),this.is_submitting=!1}},{key:"_buildContainer",value:function(){var e=this.Form.form.querySelector(".glsr-captcha-holder");if(!e)return!1;this.instance&&this.instance.destroy(),Array.from(e.getElementsByClassName(GLSR.captcha.class)).forEach((function(e){return e.remove()}));var t=k("div",{class:GLSR.captcha.class});return e.appendChild(t),t}},{key:"_renderFrcaptcha",value:function(){var e=this;this.captchaEl.dataset.sitekey=GLSR.captcha.sitekey,this.instance=new friendlyChallenge.WidgetInstance(this.captchaEl,{doneCallback:function(t){e.captchaEl.dataset.token=1},errorCallback:function(t){e.captchaEl.dataset.token=1}})}},{key:"_renderRecaptcha",value:function(){var e=this;try{this.id=grecaptcha.render(this.captchaEl,{badge:GLSR.captcha.badge,callback:function(t){return e.Form.submitForm(t)},"error-callback":function(){e.captchaEl.dataset.error=1},"expired-callback":function(){return e.reset()},isolated:!0,sitekey:GLSR.captcha.sitekey,size:GLSR.captcha.size,theme:GLSR.captcha.theme})}catch(e){this.captchaEl.dataset.error=1,console.error(e)}}}]),e}(),T={classNames:{active:"gl-active",base:"gl-star-rating",selected:"gl-selected"},clearable:!0,maxStars:10,prebuilt:!1,stars:null,tooltip:"Select a Rating"},A=function(e,t,i){e.classList[t?"add":"remove"](i)},F=function(e){var t=document.createElement("span");for(var i in e=e||{})t.setAttribute(i,e[i]);return t},G=function(e,t,i){return/^\d+$/.test(e)&&t<=e&&e<=i},N=function(e,t,i){var n=F(i);return e.parentNode.insertBefore(n,t?e.nextSibling:e),n},M=function e(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s={};return i.forEach((function(t){Object.keys(t||{}).forEach((function(n){if(void 0!==i[0][n]){var r=t[n];"Object"!==O(r)||"Object"!==O(s[n])?s[n]=r:s[n]=e(s[n],r)}}))})),s},O=function(e){return{}.toString.call(e).slice(8,-1)},C=function(e){var t=[];return[].forEach.call(e.options,(function(e){var i=parseInt(e.value,10)||0;i>0&&t.push({index:e.index,text:e.text,value:i})})),t.sort((function(e,t){return e.value-t.value}))},q="undefined"!=typeof window?window:{screen:{},navigator:{}},P=(q.matchMedia||function(){return{matches:!1}}).bind(q),j=!1,H={get passive(){return j=!0}},D=function(){};q.addEventListener&&q.addEventListener("p",D,H),q.removeEventListener&&q.removeEventListener("p",D,!1);var I=j,V="ontouchstart"in q,B="TouchEvent"in q;V||B&&P("(any-pointer: coarse)").matches;q.navigator.maxTouchPoints;var W=q.navigator.userAgent||"";P("(pointer: coarse)").matches&&/iPad|Macintosh/.test(W)&&Math.min(q.screen.width||0,q.screen.height||0);(P("(pointer: coarse)").matches||!P("(pointer: fine)").matches&&V)&&/Windows.*Firefox/.test(W),P("(any-pointer: fine)").matches||P("(any-hover: hover)").matches;var Y=function(){function e(t,i){p(this,e),this.direction=window.getComputedStyle(t,null).getPropertyValue("direction"),this.el=t,this.events={change:this.onChange.bind(this),keydown:this.onKeyDown.bind(this),mousedown:this.onPointerDown.bind(this),mouseleave:this.onPointerLeave.bind(this),mousemove:this.onPointerMove.bind(this),reset:this.onReset.bind(this),touchend:this.onPointerDown.bind(this),touchmove:this.onPointerMove.bind(this)},this.indexActive=null,this.indexSelected=null,this.props=i,this.tick=null,this.ticking=!1,this.values=C(t),this.widgetEl=null,this.el.widget&&this.el.widget.destroy(),G(this.values.length,1,this.props.maxStars)?this.build():this.destroy()}return m(e,[{key:"build",value:function(){this.destroy(),this.buildWidget(),this.selectValue(this.indexSelected=this.selected(),!1),this.handleEvents("add"),this.el.widget=this}},{key:"buildWidget",value:function(){var e,t,i=this;this.props.prebuilt?(e=this.el.parentNode,t=e.querySelector("."+this.props.classNames.base+"--stars")):((e=N(this.el,!1,{class:this.props.classNames.base})).appendChild(this.el),t=N(this.el,!0,{class:this.props.classNames.base+"--stars"}),this.values.forEach((function(e,n){var s=F({"data-index":n,"data-value":e.value});"function"==typeof i.props.stars&&i.props.stars.call(i,s,e,n),[].forEach.call(s.children,(function(e){return e.style.pointerEvents="none"})),t.innerHTML+=s.outerHTML}))),e.dataset.starRating="",e.classList.add(this.props.classNames.base+"--"+this.direction),this.props.tooltip&&t.setAttribute("role","tooltip"),this.widgetEl=t}},{key:"changeIndexTo",value:function(e,t){var i=this;if(this.indexActive!==e||t){if([].forEach.call(this.widgetEl.children,(function(t,n){A(t,n<=e,i.props.classNames.active),A(t,n===i.indexSelected,i.props.classNames.selected)})),this.widgetEl.setAttribute("data-rating",e+1),"function"==typeof this.props.stars||this.props.prebuilt||(this.widgetEl.classList.remove("s"+10*(this.indexActive+1)),this.widgetEl.classList.add("s"+10*(e+1))),this.props.tooltip){var n,s=e<0?this.props.tooltip:null===(n=this.values[e])||void 0===n?void 0:n.text;this.widgetEl.setAttribute("aria-label",s)}this.indexActive=e}this.ticking=!1}},{key:"destroy",value:function(){this.indexActive=null,this.indexSelected=this.selected();var e=this.el.parentNode;e.classList.contains(this.props.classNames.base)&&(this.props.prebuilt?(this.widgetEl=e.querySelector("."+this.props.classNames.base+"--stars"),e.classList.remove(this.props.classNames.base+"--"+this.direction),delete e.dataset.starRating):e.parentNode.replaceChild(this.el,e),this.handleEvents("remove")),delete this.el.widget}},{key:"eventListener",value:function(e,t,i,n){var s=this;i.forEach((function(i){return e[t+"EventListener"](i,s.events[i],n||!1)}))}},{key:"handleEvents",value:function(e){var t=this.el.closest("form");t&&"FORM"===t.tagName&&this.eventListener(t,e,["reset"]),this.eventListener(this.el,e,["change"]),"add"===e&&this.el.disabled||(this.eventListener(this.el,e,["keydown"]),this.eventListener(this.widgetEl,e,["mousedown","mouseleave","mousemove","touchend","touchmove"],!!I&&{passive:!1}))}},{key:"indexFromEvent",value:function(e){var t,i,n=(null===(t=e.touches)||void 0===t?void 0:t[0])||(null===(i=e.changedTouches)||void 0===i?void 0:i[0])||e,s=document.elementFromPoint(n.clientX,n.clientY);return s.parentNode===this.widgetEl?[].slice.call(s.parentNode.children).indexOf(s):this.indexActive}},{key:"onChange",value:function(){this.changeIndexTo(this.selected(),!0)}},{key:"onKeyDown",value:function(e){var t=e.key.slice(5);if(~["Left","Right"].indexOf(t)){var i="Left"===t?-1:1;"rtl"===this.direction&&(i*=-1);var n=this.values.length-1,s=Math.min(Math.max(this.selected()+i,-1),n);this.selectValue(s,!0)}}},{key:"onPointerDown",value:function(e){e.preventDefault();var t=this.indexFromEvent(e);this.props.clearable&&t===this.indexSelected&&(t=-1),this.selectValue(t,!0)}},{key:"onPointerLeave",value:function(e){var t=this;e.preventDefault(),cancelAnimationFrame(this.tick),requestAnimationFrame((function(){return t.changeIndexTo(t.indexSelected)}))}},{key:"onPointerMove",value:function(e){var t=this;e.preventDefault(),this.ticking||(this.tick=requestAnimationFrame((function(){return t.changeIndexTo(t.indexFromEvent(e))})),this.ticking=!0)}},{key:"onReset",value:function(){var e,t=this.valueIndex(null===(e=this.el.querySelector("[selected]"))||void 0===e?void 0:e.value);this.selectValue(t||-1,!1)}},{key:"selected",value:function(){return this.valueIndex(this.el.value)}},{key:"selectValue",value:function(e,t){var i;this.el.value=(null===(i=this.values[e])||void 0===i?void 0:i.value)||"",this.indexSelected=this.selected(),!1===t?this.changeIndexTo(this.selected(),!0):this.el.dispatchEvent(new Event("change"))}},{key:"valueIndex",value:function(e){return this.values.findIndex((function(t){return t.value===+e}))}}]),e}(),$=function(){function e(t,i){p(this,e),this.destroy=this.destroy.bind(this),this.props=i,this.rebuild=this.rebuild.bind(this),this.selector=t,this.widgets=[],this.build()}return m(e,[{key:"build",value:function(){var e=this;this.queryElements(this.selector).forEach((function(t){var i=M(T,e.props,JSON.parse(t.getAttribute("data-options")));"SELECT"!==t.tagName||t.widget||(!i.prebuilt&&t.parentNode.classList.contains(i.classNames.base)&&e.unwrap(t),e.widgets.push(new Y(t,i)))}))}},{key:"destroy",value:function(){this.widgets.forEach((function(e){return e.destroy()})),this.widgets=[]}},{key:"queryElements",value:function(e){return"HTMLSelectElement"===O(e)?[e]:"NodeList"===O(e)?[].slice.call(e):"String"===O(e)?[].slice.call(document.querySelectorAll(e)):[]}},{key:"rebuild",value:function(){this.destroy(),this.build()}},{key:"unwrap",value:function(e){var t=e.parentNode,i=t.parentNode;i.insertBefore(e,t),i.removeChild(t)}}]),e}(),K=function(e,t,i){e&&t.split(" ").forEach((function(t){e.classList[i?"add":"remove"](t)}))},X=function(e){return"."+e.trim().split(" ").join(".")},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,i=null;return function(){clearTimeout(i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];i=setTimeout.apply(void 0,[e,t].concat(s))}},z=function(e){var t='input[name="'+e.getAttribute("name")+'"]:checked';return e.validation.form.querySelectorAll(t).length},U={email:{fn:function(e){return!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}},max:{fn:function(e,t){return!e||("checkbox"===this.type?z(this)<=parseInt(t):parseFloat(e)<=parseFloat(t))}},maxlength:{fn:function(e,t){return!e||e.length<=parseInt(t)}},min:{fn:function(e,t){return!e||("checkbox"===this.type?z(this)>=parseInt(t):parseFloat(e)>=parseFloat(t))}},minlength:{fn:function(e,t){return!e||e.length>=parseInt(t)}},number:{fn:function(e){return!e||!isNaN(parseFloat(e))},priority:2},pattern:{fn:function(e,t){var i=t.match(new RegExp("^/(.*?)/([gimy]*)$"));return!e||new RegExp(i[1],i[2]).test(e)}},required:{fn:function(e){return"radio"===this.type||"checkbox"===this.type?z(this):void 0!==e&&""!==e},priority:99,halt:!0},tel:{fn:function(e){var t=e.replace(/[^0-9]/g,"").length;return!e||4<=t&&15>=t&&new RegExp("^[+]?[\\d\\s()-]*$").test(e)}},url:{fn:function(e){return!e||new RegExp("^(https?)://([\\p{L}\\p{N}\\p{S}\\-_.])+(.?([\\p{L}\\p{N}]|xn--[\\p{L}\\p{N}\\-]+)+.?)(:[0-9]+)?(?:/(?:[\\p{L}\\p{N}\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*(?:\\?(?:[\\p{L}\\p{N}\\-._~!$&'\\[\\]()*+,;=:@/?]|%[0-9A-Fa-f]{2})*)?(?:#(?:[\\p{L}\\p{N}\\-._~!$&'()*+,;=:@/?]|%[0-9A-Fa-f]{2})*)?$","iu").test(e)}}},Q=["required","max","maxlength","min","minlength","pattern"],Z="input:not([type^=hidden]):not([type^=submit]), select, textarea, [data-glsr-validate]",ee=function(){function e(t){p(this,e),this.config=GLSR.validationconfig,this.fields=[],this.form=t,this.form.setAttribute("novalidate",""),this.strings=GLSR.validationstrings,this.validateEvent=this._onChange.bind(this)}return m(e,[{key:"destroy",value:function(){for(this.reset();this.fields.length;){var e=this.fields.shift();this._removeEvent(e.input),delete e.input.validation}}},{key:"init",value:function(){var e=this;this.form.querySelectorAll(Z).forEach((function(t){if(!e.fields.find((function(e){return e.input.name===t.name&&!t.name.endsWith("[]")}))){var i=t.closest(X(e.config.field));i&&"none"!==i.style.display&&e.fields.push(e._initField(t))}}))}},{key:"reset",value:function(){for(var e in this.fields)if(this.fields.hasOwnProperty(e)){this.fields[e].errorElements=null;var t=this.fields[e].input.closest(X(this.config.field));K(this.fields[e].input,this.config.input_error,!1),K(this.fields[e].input,this.config.input_valid,!1),K(t,this.config.field_error,!1),K(t,this.config.field_valid,!1)}}},{key:"setErrors",value:function(e,t){e.hasOwnProperty("validation")&&this._initField(e),e.validation.errors=t}},{key:"toggleError",value:function(e,t){var i=e.input.closest(X(this.config.field));if(K(e.input,this.config.input_error,t),K(e.input,this.config.input_valid,!t),i){K(i,this.config.field_error,t),K(i,this.config.field_valid,!t);var n=i.querySelector(X(this.config.field_message));n.innerHTML=t?e.errors.join("<br>"):"",n.style.display=t?"":"none"}}},{key:"validate",value:function(e){var t=!0,i=this.fields;for(var n in e instanceof HTMLElement&&(i=[e.validation]),i)if(i.hasOwnProperty(n)){var s=i[n];this._validateField(s)?this.toggleError(s,!1):(t=!1,this.toggleError(s,!0))}return t}},{key:"_addEvent",value:function(e){e.addEventListener(this._getEventName(e),this.validateEvent)}},{key:"_addValidators",value:function(e,t,i){var n=this;[].forEach.call(e,(function(e){var s=e.name.replace("data-","");~Q.indexOf(s)?n._addValidatorToField(t,i,s,e.value):"type"===e.name&&n._addValidatorToField(t,i,e.value)}))}},{key:"_addValidatorToField",value:function(e,t,i,n){if(U[i]&&(U[i].name=i,e.push(U[i]),n)){var s="pattern"===i?[n]:n.split(",");s.unshift(null),t[i]=s}}},{key:"_onChange",value:function(e){this.validate(e.currentTarget)}},{key:"_removeEvent",value:function(e){e.removeEventListener(this._getEventName(e),this.validateEvent)}},{key:"_getEventName",value:function(e){return~["radio","checkbox"].indexOf(e.getAttribute("type"))||"SELECT"===e.nodeName?"change":"input"}},{key:"_initField",value:function(e){var t=this,i={},n=[];return null!==e.offsetParent&&(this._addValidators(e.attributes,n,i),this._sortValidators(n),this._addEvent(e)),e.validation={form:this.form,input:e,params:i,validate:function(){return t.validate(e)},validators:n}}},{key:"_sortValidators",value:function(e){e.sort((function(e,t){return(t.priority||1)-(e.priority||1)}))}},{key:"_validateField",value:function(e){var t=[],i=!0;for(var n in e.validators)if(e.validators.hasOwnProperty(n)){var s=e.validators[n],r=e.params[s.name]?e.params[s.name]:[];if(r[0]=e.input.value,!s.fn.apply(e.input,r)){i=!1;var o=this.strings[s.name];if(t.push(o.replace(/(\%s)/g,r[1])),!0===s.halt)break}}return e.errors=t,i}}]),e}(),te=function(){function e(t,i){p(this,e),this.button=i,this.config=GLSR.validationconfig,this.events={submit:this._onSubmit.bind(this)},this.form=t,this.isActive=!1,this.stars=null,this.strings=GLSR.validationstrings,this.useAjax=!t.classList.contains("no-ajax"),this.captcha=new R(this),this.validation=new ee(t)}return m(e,[{key:"destroy",value:function(){this._destroyForm(),this._destroyStarRatings(),this.captcha.reset(),this.isActive=!1}},{key:"disableButton",value:function(){this.button.setAttribute("aria-busy","true"),this.button.setAttribute("disabled","")}},{key:"enableButton",value:function(){this.button.setAttribute("aria-busy","false"),this.button.removeAttribute("disabled")}},{key:"init",value:function(){this.isActive||(this._initForm(),this._initStarRatings(),this.captcha.render(),this.isActive=!0)}},{key:"submitForm",value:function(e){this.disableButton(),this.form["g-recaptcha-response"]&&(this.form["g-recaptcha-response"].value=e),GLSR.ajax.post(this.form,this._handleResponse.bind(this))}},{key:"_destroyForm",value:function(){this.form.removeEventListener("submit",this.events.submit),this._resetErrors(),this.validation.destroy()}},{key:"_destroyStarRatings",value:function(){this.stars&&this.stars.destroy()}},{key:"_handleResponse",value:function(e,t){var i=!0===t;this.captcha.reset(),i&&this.form.reset(),this._showFieldErrors(e.errors),this._showResults(e.message,i),this.enableButton(),GLSR.Event.trigger("site-reviews/form/handle",e,this.form),e.form=this.form,document.dispatchEvent(new CustomEvent("site-reviews/after/submission",{detail:e})),i&&""!==e.redirect&&(window.location=e.redirect)}},{key:"_initForm",value:function(){this._destroyForm(),this.form.addEventListener("submit",this.events.submit),this.validation.init()}},{key:"_initStarRatings",value:function(){null!==this.stars?this.stars.rebuild():this.stars=new $(this.form.querySelectorAll(".glsr-field-rating select"),GLSR.stars)}},{key:"_onSubmit",value:function(e){if(!this.validation.validate())return e.preventDefault(),void this._showResults(this.strings.errors,!1);e.preventDefault(),this._resetErrors(),this.disableButton(),this.captcha.execute()}},{key:"_resetErrors",value:function(){K(this.form,this.config.form_error,!1),this._showResults("",null),this.validation.reset()}},{key:"_showFieldErrors",value:function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)){var i=GLSR.nameprefix?GLSR.nameprefix+"["+t+"]":t,n=this.form.querySelector('[name="'+i+'"]');n&&(this.validation.setErrors(n,e[t]),this.validation.toggleError(n.validation,"add"))}}},{key:"_showResults",value:function(e,t){var i=this.form.querySelector(X(this.config.form_message));null!==i&&(K(this.form,this.config.form_error,!1===t),K(i,this.config.form_message_failed,!1===t),K(i,this.config.form_message_success,!0===t),i.innerHTML=e)}}]),e}(),ie=function(){return"undefined"==typeof window},ne=function(e){e=e||navigator.userAgent;var t=/(iPad).*OS\s([\d_]+)/.test(e);return{ios:!t&&/(iPhone\sOS)\s([\d_]+)/.test(e)||t,android:/(Android);?[\s/]+([\d.]+)?/.test(e)}};function se(e){if(ie())return!1;if(!e)throw new Error("options must be provided");var t=!1,i={get passive(){t=!0}},n=function(){},s="__TUA_BSL_TEST_PASSIVE__";window.addEventListener(s,n,i),window.removeEventListener(s,n,i);var r=e.capture;return t?e:void 0!==r&&r}var re=0,oe=0,ae=0,le=null,ce=!1,ue=[],he=se({passive:!1}),de=!ie()&&"scrollBehavior"in document.documentElement.style,fe=function(){var e=document.body,t=Object.assign({},e.style),i=window.innerWidth-e.clientWidth;return e.style.overflow="hidden",e.style.boxSizing="border-box",e.style.paddingRight="".concat(i,"px"),function(){["overflow","boxSizing","paddingRight"].forEach((function(i){e.style[i]=t[i]||""}))}},ve=function(){var e=document.documentElement,t=document.body,i=e.scrollTop||t.scrollTop,n=Object.assign({},e.style),s=Object.assign({},t.style);return e.style.height="100%",e.style.overflow="hidden",t.style.top="-".concat(i,"px"),t.style.width="100%",t.style.height="auto",t.style.position="fixed",t.style.overflow="hidden",function(){e.style.height=n.height||"",e.style.overflow=n.overflow||"",["top","width","height","overflow","position"].forEach((function(e){t.style[e]=s[e]||""})),de?window.scrollTo({top:i,behavior:"instant"}):window.scrollTo(0,i)}},pe=function(e){e.cancelable&&e.preventDefault()},ge=function(e,t){if(t){var i=t.scrollTop,n=t.scrollLeft,s=t.scrollWidth,r=t.scrollHeight,o=t.clientWidth,a=t.clientHeight,l=e.targetTouches[0].clientX-ae,c=e.targetTouches[0].clientY-oe,u=Math.abs(c)>Math.abs(l);if(u&&(c>0&&0===i||c<0&&i+a+1>=r)||!u&&(l>0&&0===n||l<0&&n+o+1>=s))return pe(e)}return e.stopPropagation(),!0},me=function(e){e||null!==e&&"production"!==process.env.NODE_ENV&&console.warn("If scrolling is also required in the floating layer, the target element must be provided.")},ye=function(e){if(!ie()){if(me(e),ne().ios){if(e)(Array.isArray(e)?e:[e]).forEach((function(e){e&&-1===ue.indexOf(e)&&(e.ontouchstart=function(e){oe=e.targetTouches[0].clientY,ae=e.targetTouches[0].clientX},e.ontouchmove=function(t){1===t.targetTouches.length&&ge(t,e)},ue.push(e))}));ce||(document.addEventListener("touchmove",pe,he),ce=!0)}else re<=0&&(le=ne().android?ve():fe());re+=1}},be=function(e){if(!(ie()||(me(e),(re-=1)>0)))if(ne().ios||"function"!=typeof le){if(e)(Array.isArray(e)?e:[e]).forEach((function(e){var t=ue.indexOf(e);-1!==t&&(e.ontouchmove=null,e.ontouchstart=null,ue.splice(t,1))}));ce&&(document.removeEventListener("touchmove",pe,he),ce=!1)}else le()},we=["[contenteditable]",'[tabindex]:not([tabindex^="-"])',"a[href]","button:not([disabled]):not([aria-hidden])",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])"],Ee={focus:!1,onClose:function(){},onOpen:function(){}},_e="data-glsr-close",ke="glsr-modal",Le="is-open",Se="data-glsr-trigger",xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.class=ke+"__"+e,t},Re=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p(this,e),this.config=Object.assign({},Ee,i),this.events={_open:this._openModal.bind(this),mouseup:this._onClick.bind(this),keydown:this._onKeydown.bind(this),touchstart:this._onClick.bind(this)},this.id=t,this.triggers=[],this._reset()}return m(e,[{key:"_closeModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&(t.preventDefault(),t.stopPropagation()),this.root.setAttribute("aria-hidden","true"),this._eventHandler("remove"),be(this.content),this.trigger&&this.trigger.focus&&this.trigger.focus();var i=function i(){e.root.removeEventListener("animationend",i,!1),e.root.classList.remove(Le),Ae.pop(),e.config.onClose(e,t),GLSR.Event.trigger("site-reviews/modal/close",e.root,e.trigger,t),J((function(){return e._reset()}))()};this.root.addEventListener("animationend",i,!1)}},{key:"_eventHandler",value:function(e){this._eventListener(this.close,e,["keydown"]),this._eventListener(this.root,e,["mouseup","touchstart"]),this._eventListener(document,e,["keydown"])}},{key:"_eventListener",value:function(e,t,i){var n=this;e&&i.forEach((function(i){return e[t+"EventListener"](i,n.events[i])}))}},{key:"_focusableNodes",value:function(){return[].slice.call(this.root.querySelectorAll(we))}},{key:"_insertModal",value:function(){var e=k("button",xe("close",{"aria-label":GLSR.text.closemodal,"data-glsr-close":""})),t=k("div",xe("content",{tabindex:-1})),i=k("div",xe("header")),n=k("div",xe("footer")),s=k("div",{class:ke,id:this.id,"aria-hidden":!0},k("div",xe("overlay",{tabindex:-1,"data-glsr-close":""}),k("div",xe("dialog",{"aria-modal":!0,role:"dialog"}),e,i,t,n)));this.close=e,this.content=t,this.footer=n,this.header=i,this.root=document.body.appendChild(s)}},{key:"_onClick",value:function(e){e.target.hasAttribute(_e)&&this._closeModal(e)}},{key:"_onKeydown",value:function(e){~[13,32].indexOf(e.keyCode)&&e.target===this.close&&this._closeModal(e),27===e.keyCode&&Ae.slice(-1)[0]===this.id&&this._closeModal(e),9===e.keyCode&&this._retainFocus(e)}},{key:"_openModal",value:function(e){var t=this;Ae.push(this.id),this.trigger=document.activeElement,e&&(e.preventDefault(),this.trigger=e.currentTarget),this._insertModal(),ye(this.content),this.config.onOpen(this,e),GLSR.Event.trigger("site-reviews/modal/open",this.root,this.trigger,e),this.root.setAttribute("aria-hidden","false"),this.root.classList.add(Le),this._eventHandler("add");this.root.addEventListener("animationend",(function e(){t.root.removeEventListener("animationend",e,!1),t._setFocusToFirstNode()}),!1)}},{key:"_registerTrigger",value:function(e){this._removeTrigger(e),e.addEventListener("click",this.events._open),this.triggers.push(e)}},{key:"_removeTrigger",value:function(e){this.triggers.filter((function(t){return t!==e})),e.removeEventListener("click",this.events._open)}},{key:"_removeTriggers",value:function(){var e=this;this.triggers.forEach((function(t){return e._removeTrigger(t)})),this.triggers=[]}},{key:"_reset",value:function(){this.root&&this.root.remove(),this.close=null,this.content=null,this.footer=null,this.header=null,this.trigger=null}},{key:"_retainFocus",value:function(e){var t=this._focusableNodes();if(0!==t.length)if(t=t.filter((function(e){return null!==e.offsetParent})),this.root.contains(document.activeElement)){var i=t.indexOf(document.activeElement);e.shiftKey&&0===i?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&t.length>0&&i===t.length-1&&(t[0].focus(),e.preventDefault())}else t[0].focus()}},{key:"_setFocusToFirstNode",value:function(){if(this.config.focus){var e=this._focusableNodes();if(0!==e.length){var t=e.filter((function(e){return!e.hasAttribute(_e)}));t.length>0?t[0].focus():0===t.length&&e[0].focus()}}}}]),e}(),Te={},Ae=[],Fe=function(e){if(e)Te[e]&&Te[e]._closeModal();else for(var t in Te)Te[t]._closeModal()},Ge=function(e,t){var i=Te[e]||new Re(e,t);return i._removeTriggers(),document.querySelectorAll("["+Se+"]").forEach((function(t){e===t.attributes[Se].value&&i._registerTrigger(t)})),Te[e]=i,Te},Ne=function(e,t){var i=Te[e]||new Re(e,t);i.root&&i._eventHandler("remove"),Te[e]=i,i._openModal()},Me={close:Fe,init:Ge,open:Ne},Oe={hide:"glsr-hide"},Ce={scrollOffset:16,scrollTime:468},qe={button:"button.glsr-button-loadmore",link:".glsr-pagination a.page-numbers",pagination:".glsr-pagination",reviews:".glsr-reviews, [data-reviews]"},Pe=function(){function e(t,i){p(this,e),this.events={button:{click:this._onLoadMore.bind(this)},link:{click:this._onPaginate.bind(this)},window:{popstate:this._onPopstate.bind(this)}},this.paginationEl=i,this.reviewsEl=t.querySelector(qe.reviews),this.wrapperEl=t}return m(e,[{key:"destroy",value:function(){this._eventHandler("remove")}},{key:"init",value:function(){this._eventHandler("add");var e=this.paginationEl.querySelector(".current");if(e){var t=this._data(e),i=e.nextElementSibling;t&&i&&2==+i.dataset.page&&GLSR.urlparameter&&window.history.replaceState(t,"",window.location)}}},{key:"_data",value:function(e){try{for(var t=JSON.parse(JSON.stringify(this.paginationEl.dataset)),i={},n=0,s=Object.keys(t);n<s.length;n++){var r=s[n],o=void 0;try{o=JSON.parse(t[r])}catch(e){o=t[r]}i["".concat(GLSR.nameprefix,"[atts][").concat(r,"]")]=o}return i["".concat(GLSR.nameprefix,"[_action]")]="fetch-paged-reviews",i["".concat(GLSR.nameprefix,"[page]")]=e.dataset.page||1,i["".concat(GLSR.nameprefix,"[schema]")]=!1,i["".concat(GLSR.nameprefix,"[url]")]=e.href||location.href,i}catch(e){return console.error("Invalid pagination config."),!1}}},{key:"_eventHandler",value:function(e){var t=this;this._eventListener(window,e,this.events.window),this.wrapperEl.querySelectorAll(qe.button).forEach((function(i){t._eventListener(i,e,t.events.button)})),this.wrapperEl.querySelectorAll(qe.link).forEach((function(i){t._eventListener(i,e,t.events.link)}))}},{key:"_eventListener",value:function(e,t,i){Object.keys(i).forEach((function(n){return e[t+"EventListener"](n,i[n])}))}},{key:"_handleLoadMore",value:function(e,t,i,n){n?(e.setAttribute("aria-busy","false"),e.removeAttribute("disabled"),this.destroy(),this.paginationEl.innerHTML=i.pagination,this.reviewsEl.insertAdjacentHTML("beforeend",i.reviews),this.init(),GLSR.Event.trigger("site-reviews/pagination/handle",i,this)):window.location=location}},{key:"_handlePagination",value:function(e,t,i,n){n?(this._paginate(i),GLSR.urlparameter&&window.history.pushState(t,"",e.href)):window.location=e.href}},{key:"_handlePopstate",value:function(e,t,i){i?this._paginate(t):console.error(t)}},{key:"_onLoadMore",value:function(e){var t=e.currentTarget,i=this._data(t);i&&(t.setAttribute("aria-busy","true"),t.setAttribute("disabled",""),e.preventDefault(),GLSR.ajax.post(i,this._handleLoadMore.bind(this,t,i)))}},{key:"_onPaginate",value:function(e){var t=e.currentTarget,i=this._data(t);i&&(this.wrapperEl.classList.add(Oe.hide),e.preventDefault(),GLSR.ajax.post(i,this._handlePagination.bind(this,t,i)))}},{key:"_onPopstate",value:function(e){GLSR.Event.trigger("site-reviews/pagination/popstate",e,this),e.state&&e.state["".concat(GLSR.nameprefix,"[_action]")]&&(this.wrapperEl.classList.add(Oe.hide),GLSR.ajax.post(e.state,this._handlePopstate.bind(this,e.state)))}},{key:"_paginate",value:function(e){this.destroy(),this.paginationEl.innerHTML=e.pagination,this.reviewsEl.innerHTML=e.reviews,this.init(),this._scrollToTop(),this.wrapperEl.classList.remove(Oe.hide),GLSR.Event.trigger("site-reviews/pagination/handle",e,this)}},{key:"_scrollStep",value:function(e){var t=Math.min(1,(window.performance.now()-e.startTime)/Ce.scrollTime),i=.5*(1-Math.cos(Math.PI*t)),n=e.startY+(e.endY-e.startY)*i;window.scroll(0,e.offset+n),n!==e.endY&&window.requestAnimationFrame(this._scrollStep.bind(this,e))}},{key:"_scrollToTop",value:function(){var e=Ce.scrollOffset;[].forEach.call(GLSR.ajaxpagination,(function(t){var i=document.querySelector(t);i&&"fixed"===window.getComputedStyle(i).getPropertyValue("position")&&(e+=i.clientHeight)}));var t=this.reviewsEl.getBoundingClientRect().top-e;t>0||this._scrollStep({endY:t,offset:window.pageYOffset,startTime:window.performance.now(),startY:this.reviewsEl.scrollTop})}}]),e}(),je={excerpts:"site-reviews/excerpts/init",forms:"site-reviews/forms/init",init:"site-reviews/init",modal:"site-reviews/modal/init",pagination:"site-reviews/pagination/init"},He=function(e){new x(e)},De=function(){GLSR.forms.forEach((function(e){return e.destroy()})),GLSR.forms=[],document.querySelectorAll("form.glsr-review-form").forEach((function(e){var t=e.querySelector("[type=submit]");if(t){var i=new te(e,t);i.init(),GLSR.forms.push(i)}}))},Ie=function(){GLSR.Modal.init("glsr-modal-review",{onOpen:function(e){var t=e.trigger.closest(".glsr").cloneNode(!0),i=e.trigger.closest(".glsr-review").cloneNode(!0);t.innerHTML="",t.appendChild(i),e.content.appendChild(t)}})},Ve=function(){GLSR.pagination.forEach((function(e){return e.destroy()})),GLSR.pagination=[],document.querySelectorAll(".glsr").forEach((function(e){var t=e.querySelector(".glsr-pagination");if(t&&(t.classList.contains("glsr-ajax-loadmore")||t.classList.contains("glsr-ajax-pagination"))){var i=new Pe(e,t);i.init(),GLSR.pagination.push(i)}}))},Be=function(){document.querySelectorAll(".glsr").forEach((function(e){var t="glsr-"+window.getComputedStyle(e,null).getPropertyValue("direction");e.classList.add(t)})),v.trigger(je.excerpts),v.trigger(je.forms),v.trigger(je.modal),v.trigger(je.pagination)};window.hasOwnProperty("GLSR")||(window.GLSR={}),window.GLSR.ajax=l,window.GLSR.forms=[],window.GLSR.pagination=[],window.GLSR.Event=v,window.GLSR.Modal=Me,window.GLSR.Utils={debounce:J,dom:k},v.on(je.excerpts,He),v.on(je.forms,De),v.on(je.modal,Ie),v.on(je.pagination,Ve),v.on(je.init,Be),v.on("site-reviews/pagination/handle",(function(e,t){v.trigger(je.excerpts,t.wrapperEl),v.trigger(je.modal)})),document.addEventListener("DOMContentLoaded",(function(){v.trigger(je.init)}))}();
